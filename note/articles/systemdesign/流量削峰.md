# 流量削峰

- 目录
   - [消息队列缓冲请求](#消息队列缓冲请求)
   - [消息队列缓冲请求](#消息队列缓冲请求)
   - [总结](#总结)

高并发场景往往需要流量削峰，削峰就是延缓用户请求，层层过滤，尽可能少的让请求落到系统下游。流量削峰的处理方式主要有请求缓冲和流量漏斗。

### 消息队列缓冲请求

流量削峰最容易想到的是利用消息队列来缓冲请求。将同步请求转化成异步请求，两端通过消息队列平滑的处理请求，这是一种事件驱动的设计思想。

消息队列的常见使用场景：应用解构、异步消息、流量削峰。

消息队列只是事件驱动的一种体现，毕竟造好的轮子不用白不用啊，我们也可以自己实现中间件来缓冲请求。

### 流量漏斗逐层削峰

除了请求缓冲，我们还可以对请求进行分层过滤，分层过滤的目的是系统上游尽可能拦截和过滤请求。

- CDN：处理静态资源请求。
- 前台读系统：缓存热点数据，尽可能读缓存，并过滤掉无效请求。
- 后台写系统：二次校验过滤请求，对写请求做好保护和限流。
- DB：数据库保持强一致性。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/systemdesign/流量漏斗逐层削峰.png" width="600px">
</div>

### 总结

流量削峰可以通过消息队列来缓冲请求，通过分层过滤将请求拦截在系统上游，减少数据库操作。还要避免单点问题，不能让系统上游成为系统瓶颈甚至宕机导致系统不可用。

