# 什么是消息队列

> 在计算机科学中，消息队列（英语：Message queue）是一种进程间通信或同一进程的不同线程间的通信方式，软件的贮列用来处理一系列的输入，通常是来自用户。
> 消息队列提供了异步的通信协议，每一个贮列中的纪录包含详细说明的资料，包含发生的时间，输入设备的种类，以及特定的输入参数，也就是说：消息的发送者和接收者不需要同时与消息队列交互。
> 消息会保存在队列中，直到接收者取回它。
>
> 维基百科

消息队列本身是异步的，它允许接收者在消息发送很长时间后再取回消息，这和大多数通信协议是不同的。例如 WWW 中使用的 HTTP 协议（HTTP/2之前）是同步的，因为客户端在发出请求后必须等待服务器回应。然而，很多情况下我们需要异步的通信协议。比如，一个进程通知另一个进程发生了一个事件，但不需要等待回应。但消息队列的异步特点，也造成了一个缺点，就是接收者必须轮询消息队列，才能收到最近的消息。

### 消息队列有什么用

消息队列在分布式系统中应用越来越广泛，我们看一下分布式系统的特点：可扩展性强、并发能力强，往往分布式系统为了承载更大的压力，还会将程序拆分成多个程序，这要求各个子程序之间耦合度低。

那么，消息队列在其中扮演着什么角色呢？

消息队列可以理解是一个分布式的生产者 - 消费者模型，将生产和消费分离，并提供产品（消息）存放的场所。从这个层面，我们可以看出消息队列具有解耦和异步的作用。它将一组工作分割两个阶段，通过消息来协同工作，生产者和消费者互不关心，即使消费者繁忙，也不影响生产者正常工作；而消费者只需要等待消息到来，并不关心生产者状态如何。

除了解耦和异步，消息队列还具有削峰的作用。在前台应用中，用户请求激增意味着生产者生产了大量的消息，如果没有解耦，生产者直接处理请求就有可能压跨服务。而引入了消息队列之后，大量消息积压在消息队列中，消费者逐个处理，对服务起到了缓存保护的作用，也就是削峰。如果想快速处理掉积压的消息，只需要多启动一些消费者实例即可，扩展性也很好。

简单的说，消息队列的主要作用的`解耦、异步、削峰`。