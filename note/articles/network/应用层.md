# 应用层

网络应用是网络存在的理由，如果不能构想出有用的应用，也就没有必要去设计支持它们的网络协议了。

### 进程通信

在构建网络应用之前，首先要了解多个端系统是如何互相通信的。在操作系统层面，进行通信的实际上是进程，而不是程序。一个进程可以被认为是允许在端系统中的一个程序，在两个不同端系统上的进程，通过网络交换报文而互相通信。

进程通过一个叫套接字（socket）的软件接口向网络发送报文和从网络接收报文。套接字是应用层与传输层之间的接口，它是一个建立网络应用程序的可编程接口，因此套接字也被成为应用程序和网络之间的应用程序编程接口。开发者可以控制套接字在应用层端的一切，但对该套接字在传输层端几乎没有控制权。

### 进程寻址

一台主机上运行的进程为了向另一台主机上允许的程序发送分组，接口进程需要有一个地址，在因特网中主机由起 IP 地址标识。除了需要知道目的地的主机地址外，还必须指定运行在接收主机上的接收进程（具体说，接收套接字）。一般通过端口号来实现这个目的，如 Web 服务器用端口号 80 标识。

### 应用层协议

应用层协议定义了运行在不同端系统上的应用程序如何相互传递报文，特别是应用层协议定义了：

- 交换的报文类型，例如请求报文和响应报文；
- 各种报文类型的语法，如报文中各个字段及这些字段是如何描述的；
- 字段的语义，即这些字段值包含的信息的含义；
- 一个进程何时以即如何发送报文，对报文进行响应的规则。

### Web 和 HTTP

Web 是一种客户端 - 服务器应用，它允许客户按照需求从 Web 服务器获取文档。HTTP 是 Web 的应用层协议，称超文本传输协议（HyperText Transfer Protocol）。客户端程序和服务器程序通过交换 HTTP 报文进行会话，HTTP 定义了这些报文的结构以及客户和服务器进行报文交换的方式。

HTTP 使用 TCP 作为它的支持运输协议，HTTP 客户端首先发起一个与服务器的 TCP 连接。连接一旦建立，该浏览器和服务器进程就可以通过套接字接口通信。需要注意的是，HTTP 是无状态协议，即 HTTP 服务器不保存关于客户端的任何信息。

#### 建立连接

HTTP 使用 TCP 作为它的支持运输协议，这意味着发起 HTTP 请求需要建立 TCP 连接。

建立 TCP 连接需要 "三次握手"，即客户端向服务器发送一个小 TCP 报文段，服务器用一个小的 TCP 报文段做出确认和响应，最后客户端向服务器返回确认（传输层详谈）。

这意味着，发起 HTTP 请求必须为请求的对象建立和维护一个连接。每个连接在客户端和服务器


#### HTTP 报文

用于 HTTP 协议交互的信息被称为 HTTP 报文，HTTP 报文本身是由多行数据构成的字符串文本。HTTP 报文大致可以分为报文首部和报文主体两部分，两者由空行划分。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/HTTP报文基本格式.png" width="600px">
</div>

HTTP 报文有两种：请求报文和响应报文。

- 请求报文

请求报文结构：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/请求报文结构.png" width="600px">
</div>

请求报文实例：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/请求报文实例.png" width="600px">
</div>

- 响应报文

响应报文结构：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/响应报文结构.png" width="600px">
</div>

响应报文实例：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/响应报文实例.png" width="600px">
</div>

请求报文和响应报文的首部内容由以下数据组成：

- `请求行`：包含用于请求的方法，请求的 URI 和 HTTP 版本。
- `状态行`：包含表明响应结果的状态码、原因短语和 HTTP 版本。
- `首部字段`：包含表示请求和响应的各种条件和属性的各类首部（一般有四种首部：通用首部、请求首部、响应首部、实体首部）。
- `其他`：可能包含 HTTP 的 RFC 中未定义的首部（如 Cookie）。

报文主体用于传输请求或响应的实体主体。通常报文主体等于实体主体，只有当传输中进行编码操作，实体主体的内容发送变化，报文主体和实体主体才会不一致。

- `报文`：是 HTTP 通信的基本单位，由 8 为字节流组成，通过 HTTP 通信传输。
- `实体`：作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。

报文主体并不是必须的，如 GET 类型的请求报文。

### FTP

### SMTP

### DNS

### P2P
