# 计算机网络

- 目录
    - [因特网](#因特网)
    - [协议](#协议)  
        - [OSI 参考模型](#OSI-参考模型)
        - [通信处理](#通信处理)
    - [通信方式](#通信方式)
        - [电路交换](#电路交换)
        - [分组交换](#分组交换)
             - [时延](#时延)
        - [报文交换](#报文交换)
    - [有连接和无连接](#有连接和无连接)
        - [面向有连接型](#面向有连接型)
        - [面向无连接型](#面向无连接型)
        - [区别于通信方式](#区别于通信方式) 
    - [单播、广播、多播、任播](#单播、广播、多播、任播  )
    - [网络的构成要素](#网络的构成要素)
        - [网卡](#网卡)
        - [中继器](#中继器)
        - [网桥](#网桥)
        - [路由器](#路由器)
        - [4~7 层交换机](#4~7-层交换机)
        - [网关](#网关)


计算机网络是指将地理位置不同的具有独立功能的多台计算机及其外部设备，通过通信线路连接起来，在网络操作系统，网络管理软件及网络通信协议的管理和协调下，实现资源共享和信息传递的计算机系统。

### 因特网

因特网是一个世界范围的计算机网络，即它是一个互联了遍及全世界上亿的接入网络设备的网络。网络把主机连接起来，而因特网是把多个的网络连接起来，因此因特网是网络的网络，这些网络以一组标准的网络 TCP/IP 协议族相连。

在因特网的术语中，所有的接入设备都被称为`主机`，或`端系统`。主机通过通信链路和分组交换机连接到一起。通信链路是用于传输数据的物理介质，一台主机向另一个主机发生数据时，发送端将数据分段并添加首部字节，由此产生的信息包被称为`分组`。这些分组通过网络发送到目标主机，在目标主机中被装配成原始数据。分组交换机从它的一条入通信链路接收分组，并由一条出分组转发该分组。当前因特网中最广泛使用的两种分组交换机是`路由器`和`链路层交换机`。链路层交换机通常用于接入网中，路由器一般用于网络核心。
从发送端到接收端，一个分组经历的一系列通信链路和分组交换机被称为通过该网络的`路径`。

主机通过因特网服务提供商(Internet Service Provider,ISP)接入因特网，ISP 提供各种网络服务，同时为了保证各个主机可以互联，各种 ISP 之间也要可以互联。

主机、分组交换机和其他因特网部件为了通信需要运行一系列`协议`，这些协议控制因特网中信息的接收和发送。TCP（Transmission Control Protocol，传输控制协议）和 IP（Internet Protocol，网际协议）是因特网中最重要的两个协议，因特网中的主要协议被统称为 TCP/IP 协议。

### 协议

协议就是为了计算机和计算机之间进行网络通信而事先达成的 "约定"。TCP/IP 协议是 TCP、IP、HTTP 等协议的集合。

#### OSI 参考模型

ISO（International Organization for Standardization，国际标准化组织），制定全世界工商业国际标准的国际标准建立机构。它制定了标准化 OSI（（Open System Interconnection Reference Model，开放式系统互联通信参考模型）。

OSI 参考模型：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/OSI参考模型.png" width="400px">
</div>

OSI 参考模型将通信协议中必要的功能分成 7 层，每一分层都接收由它下一层所提供的特定服务，并且负责为上一层提供特定服务。上下层之间进行交互时所遵循的约定叫 "接口"，同一层之间的交互所遵循的约定叫 "协议"。

OSI 参考模型各分层作用：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/OSI参考模型各分层作用.png" width="800px">
</div>

- 应用层：为应用程序提供服务并规定应用程序中通信相关的细节，包括文件传输、电子邮件、虚拟终端等协议。
- 表示层：将应用处理的信息转换为适合网络传输的格式，或将来自下一次的数据转换成上层能够处理的格式，即它主要负责数据格式的转换。
- 会话层：负责建立和断开通信连接，以及数据的分割等数据传输相关的管理。
- 传输层：负责可靠传输。只在通信双方节点上进行处理，而无需在路由器上处理。
- 网络层：将数据传入到目标地址，即主要负责寻址和路由选择。
- 数据链路层：负责物理层面上的互联、节点之间的通信传输。将 0、1 序列划分为有意义的数据帧传送给对方主机，即负责数据帧的发送和接收。
- 物理层：负责 0、1 比特流与电压的高低、光的闪灭互换。

#### 通信处理

OSI 模型通信处理流程：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/OSI通信处理流程.png" width="600px">
</div> 

发送端（主机 A）从第七层至第一层，由上至下按照顺序传输数据，接收端（主机 B）则从第一次至第七层由下至上按照顺序传输数据。发送端每个分层都会为从上一层接收到的数据追加必要的 "首部" 信息，接收端对接收到的数据进行 "首部" 与 "内容" 的分离，再转发给上一分层，最终还原发送端的数据。

### 通信方式

通过通信链路和分组交换机传输数据有两种基本方法：电路交换和分组交换。

#### 电路交换

电路交换需要建立一条专用的数据通信路径，这条路径上可能包含许多中间节点。进行数据交换前，首先要建立连接，当连接被建立，这条连接使用的通信路径在整个通信过程中将被独占，直到通信结束才会释放资源。

在电路交换中，数据不需要切分传输，发送端和接收端始终霸占着这条通信路径，在数据的传输上是比较高效、实时的，所以电话网络的通信方式采用的是电路交换。

但由于发送端和接收端始终霸占着这条通信路径，即使它们都没有发送任何数据，它们占用的资源也不会被释放。因此，电路交换的资源利用率是比较低的。

#### 分组交换

当前大多数网络中，主机通信是彼此交换报文。分组交换是将大的数据块（报文）分割成小的分组，并添加源地址、目的地址和分组编号等信息，按照一定顺序分别发布。

分组交换，发送端和接收端之间不需要建立连接，即不需要寻找由发送端到接收端的通信路径。发送端只需要将分组发送给路由器，路由器会根据该分组的目标地址将分组转发。

在因特网中，每个端系统具有一个称为 IP 地址的地址。当发送端要向接收端发送一个分组，发送端会在这个分组的首部中存储目标端的 IP 地址。每台路由器都具有一个`转发表`，用于将目标地址（或目标地址的一部分）映射成为输出链路。当某分组到达一台路由器，路由器会检查该分组的目标地址并搜索起转发表，以发现适当的出链路进行转发。

分组转发不需要建立从发送端到接收端的连接，没有独占资源，大大提高了资源的利用率。

但分组交换的设计思路也带来了一些问题。分组交换机在开始向输出链路传出分组之前，必须接收到整个分组。在接收到整个分组之前，交换机需要将接收到的分组存储到缓存队列，直到将分组转发。但是这就存在分组丢失的问题，当交换机缓存饱和或溢出就会丢弃分组，即`丢包`。当分组进入缓存队列，如果缓存队列中积压了很多分组，该分组就需要等待前面的分组处理完毕才能被传输，这种时延叫`排队时延`，这也意味着分组交换不具有实时性。

##### 时延

总时延 = 排队时延 + 处理时延 + 传输时延 + 传播时延。

- 排队时延

分组在路由器的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。

- 处理时延

主机或路由器收到分组时进行处理所需要的时间，例如分析首部、从分组中提取数据、进行差错检验或查找适当的路由等。

- 传输时延

主机或路由器传输数据帧所需要的时间。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/传输时延公式.png" width="100px">
</div> 

其中 l 表示数据帧的长度，v 表示传输速率。

- 传播时延

电磁波在信道中传播所需要花费的时间，电磁波传播的速度接近光速。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/传播时延公式.png" width="100px">
</div> 

其中 l 表示信道长度，v 表示电磁波在信道上的传播速度。

#### 报文交换

此外还有一致通信方式——报文交换。报文交换是分组交换的前身，报文交换以报文作为数据传输单位，携带有源地址和目的地址等信息。


和分组交换相比，报文交换对报文的大小没有限制，需要交换机有足够的缓存空间，由于单个数据包的大小更大，意味着更容易产生丢包和时延。

目前，报文交换基本上都由分组交换取代。

### 有连接和无连接

通过网络传输数据可以大致分为面向有连接传输和面向无连接传输。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/面向有连接型和面向无连接型处理模型.png" width="600px">
</div> 

#### 面向有连接型

面向有连接型在发送数据之前，需要在主机和主机之间建立一条连接。面向有连接型的通信必须经历三个阶段：`建立连接->传输数据->断开连接`。面向有连接型必须在通信传输前后，专门进行建立和断开连接，如果主机之间无法通信，就可以避免发送无谓的数据。

#### 面向无连接型

面向无连接型不要求建立连接，发送端可以自由发送数据，不需要考虑接收端是否存在，即使接收端不存在或无接收数据，发送端也会将数据发送出去。

#### 区别于通信方式

面向有连接型和面向无连接型，它们强调通信必须经历过什么样的阶段。面向连接必须经过三个阶段：`建立连接->传输数据->断开连接`，而无连接只有一个阶段：`传送数据`。

电路交换和分组交换则是强调在通信时用户对网络资源的占用方式。电路交换是在连接建立后到连接释放前全程占用信道资源，而分组交换则强调在数据传送时是断续占用信道资源（分组在哪一条链路上传送就占用该链路的资源）。

所以，不能说 "电路交换就是面向连接，而分组交换就是无连接"。

### 单播、广播、多播、任播

网络通信中，根据目标地址个数及其后续行为可以将通信分为：单播、广播、多播、任播。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/网络传播行为分类.png" width="600px">
</div> 

- 单播

单播是目的地址为单一目标的一种传输方式，它是现今网络应用最为广泛，通常所使用的网络协议或服务大多采用单播传输，例如一切基于TCP的协议。

- 广播

广播的目的地址为网络中所有设备。实际上，这里所说的 "所有设备" 也是限定在一个范围之中，称为“广播域”。

- 多播

多播也叫组播，指把信息同时传递给一组特定目的地址。它使用策略是最高效的，因为消息在每条网络链路上只需传递一次，而且只有在链路分叉的时候，消息才会被复制。

- 任播

任播是在特定多个目标地址选择一个作为目的地址的传播行为。

### 网络的构成要素

搭建一套网络需要各种网络设备和物理介质。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/网络的构成要素.png" width="600px">
</div> 

| 设备                      | 作用                            | 
| ------------------------ | ------------------------------- |
| 网卡                      | 使主机联网的设备                   |
| 中继器（Repeater）         | 从物理层上延长网络的设备             |
| 网桥（Bridge）/ 2 层交换机  | 从数据链路层上延迟网络的设备          |
| 路由器（Rputer）/ 3 层交换机 | 通过网络层转发分组数据的设备         |
| 4~7 层交换机               | 处理传输层以上各层网络传输的设别      |
| 网关（Gateway）            | 转换协议的设备                    |

#### 网卡

任何一台主机连接网络都必须需要网卡（全称"网络接口卡"，NIC），亦被叫做网络适配器、LAN 卡等。

#### 中继器

中继器在 OSI 模型的第一层——物理层，它是在物理层上延长网络的设备。由电缆传过来的电信号或光信号经由中继器的波形调整和放大再传给另一个电缆。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/中继器工作模式.png" width="600px">
</div> 

中继器只单纯负责信号在 0 和 1 比特流之间的转换，并不能判断数据是否有错误。

#### 网桥

网桥是再 OSI 模型的第二次——数据链路层，它是再数据链路层上连接两个网络的设备。它能够识别数据链路层中的数据帧，并将数据帧临时存储于内存，再重新生成信号作为一个全新的帧转发给相连的另一个网段。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/网桥工作模式.png" width="600px">
</div> 

数据链路的数据帧中有一个数据位叫 FCS，用以校验数据是否正常送达目的地。网桥通过检查这个域的值，将那些损坏的数据丢弃，从而避免发送给其他网段，此外，网桥还能通过地址自学机制和过滤功能控制网络流量。网桥中的地址指的是MAC 地址、硬件地址、物理地址和适配器地址。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/网桥自学机制.png" width="600px">
</div> 

#### 路由器

路由器（3 层交换机）是在 OSI 模型的第三次——网络层，它是在网络层面连接两个网络、并对分组报文进行转发的设备。网桥是根据物理地址（MAC 地址）进行处理，而路由器则是根据 IP 地址进行处理的。由此，TCP/IP 中网络层地址就成为了 IP 地址。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/路由器工作模式.png" width="600px">
</div>

路由器可以连接不同的数据链路，路由器还有分担网络负荷和网络安全的功能。

#### 4~7 层交换机

4~7 层交换机负责处理 OSI 模型从传输层至应用层的数据，以 TCP 等协议的传输层及其以上的应用层为基础，分析收发数据，并对其进行特定的处理。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/4-7层交换机工作模式.png" width="600px">
</div>

#### 网关

网关是 OSI 模型中负责将从传输层到应用层的数据进行转换和转发的设备。它和 4~7 层交换机 一样是处理传输层及其以上的数据。但网关不仅转发数据还负责对数据进行转换，它通常会适用一个表示层或应用层网关，在两个不能直接通信的协议之间进行翻译，最终实现两者之间的通信。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/网关工作模式.png" width="600px">
</div>