# 数据链路层

网络层为主机之间提供通信服务，两台主机之间传输数据包通过了一系列通信链路传输，有的是有线链路，有的是无线链路。

数据链路层（Data Link Layer）是 OSI 参考模型第二层，位于物理层与网络层之间，负责在两个网络实体之间提供数据链路连接的创建、维持和释放管理。

### 数据链路层概述

运行在数据链路层的设备被称为`节点`，包括主机、路由器、交换机和 WiFi 接入点。我们把沿着通信路径连接相邻节点的通信通道称为`链路`。

- 封装成帧

链路层将网络层传下来的分组添加首部和尾部封装成`链路层帧`，用于标记帧的开始和结束。

- 透明传输

帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定。需要在数据部分出现首部尾部相同的内容前面插入转义字符。如果数据部分出现转义字符，那么就在转义字符前面再加个转义字符。在接收端进行处理之后可以还原出原始数据。
这个过程透 明传输的内容是转义字符，用户察觉不到转义字符的存在。

- 差错检验和纠正

数据链路层通常通过让发送节点在帧中包括差错校验比特，让接收节点进行差错检查，以此完成差错纠正。和传输层、网络层不同，数据流量层的差错校验不仅可以检验出帧中是否出现差错，而且能准确地定位出差错位置。

- MAC 地址

MAC 地址用于识别数据链路中互相连接的节点。MAC 地址长 48 位，在使用网卡（链路层地主体实现是在网络适配器中，即网卡）的情况，MAC 地址一般烧入 ROM 中，因此每个网卡的 MAC 地址是唯一的。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/network/MAC地址规范.png" width="600px">
</div>

MAC 地址的 3-24 位标识厂商识别码，25-48 位表示厂商内部识别码，因此可以保证 MAC 地址世界唯一。

### 多路访问

网络链路分为两类：点对点链路和广播链路。

- `点对点链路`：一对一通信。

常用的协议如：PPP（point-to-point protocol，点对点协议）和 HDLC（high-level data link control，高级数据链路控制），它们都是为了点对点链路设计的链路层协议。

- `广播链路`：多个发送和接收点可以连接到相同的、单一的、共享的广播信道上。

广播链路存在一个也很重要的问题：如何协调多个发送和接收节点对一个共享广播信道的访问，即`多路访问问题`。

多路访问协议是为了解决多路访问问题，规范节点在共享广播信道上的传输行为。

多路复用协议可以划分为三种类型：信道划分协议、随机接入协议、轮流协议。

#### 信道划分协议

时分多路复用(TDM)和频分多路复用(FDM)是两种能够在所有共享信道节点之间划分广播信道带宽的技术。TDM 在时间上共享广播信道，而 FDM 将 R bps 信道划分为不同的频段（每个频段上具有 R/N 带宽），在频率上共享信道。

码分多址(CDMA)对每个节点分配一种不同的编码。然后每个节点用不同的编码方式来 对它发送的数据进行编码。如果精心选择这些编码，不同的节点能够同时传输，并且它们各自的接收方仍然正确接收发送方编码后的数据 (假设接收方知道发送方的编码)，而不怕其他节点的干扰传输。
CDMA 最早在军用系统中使用，目前已经广泛应用于民用，尤其是用于蜂窝电话中。

- 码分多址

#### 随机接入协议

在随机接入协议中，一个传输节点总是以信道的全部速率(即 R bps)进行发送。当有碰撞时，涉及碰撞的每个节点反复地重发它的帧，直到该帧顺利发送为止。但是当一个节点经受一次碰撞时，它不会立刻重发该帧，它在等待一个随机时延后重发该帧。涉及碰撞的每个节点独立地选择时延，最终能够无碰撞地将它的数据在信道中发出。

#### 轮流协议

有两种比较重要的轮流协议:轮询协议和令牌传递协议。

- 轮询协议

轮询协议要求这些节点之一要被指定为主节点。主节点以循环的方式轮询每个节点, 主节点首先向节点 1 发送一个报文，告诉它(节点 1)能够发送的最大帧数。 在节点 2 传输了某些帧后，主节点告诉节点 2 能够传输的最大帧数。在工业控制网络中这种协议还有应用。

缺点是引人了轮询时延;如果主节点有故障，整个信道会出现问题。

- 令牌传递协议

令牌传递协议中没有主节点。一个称为令牌(token)的帧在节点之 间以某种固定的次序进行交换。当一个节点收到令牌时，当它有一些帧要发送时，它才持有这个令牌。否则，它立即向下一个节点转发该令牌。令牌传递协议是一种已经废弃的技术。

缺点是节点的故障可能会使整个信道崩溃。