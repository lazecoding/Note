# Redis 为什么快

Redis 快是真的快，知其然还要知其所以然。

### 为什么快

Redis 快的影响因素：

- Redis 是基于内存操作的，内存 IO 比磁盘 IO 快了几个数量级，C 语言实现，操作内存效率更高。
- Redis 基于哈希结构构造键值数据库，读取速度快。Redis 还设计了多种特殊的数据结构，并对数据存取进行优化，如压缩列表、调表、快速列表等。
- 基于内存操作和优秀的数据结构保证了 Redis 的高效性，CPU 不会成为瓶颈，也因此 Redis 采用非阻塞的 IO 多路复用，建立自己的事件处理器，避免了线程切换时的上下文切换和竞争，而且避免了万恶的锁机制，单线程天生就是线程安全的，保证了设计的简单些。
- Redis 还设计了简单的通信协议————RESP，它是 Redis 序列化协议（Redis Serialization Protocol）的简写，实现过程简单，解析性能好，而且具有可读性。

这些因素为 Redis 的高性能提供了保障。

### 瓶颈

Redis 的性能瓶颈一般可能出现在内存容量和网络带宽。

- 内存容量：为了合理利用内存，Redis 提供了 key 的生存时间和内存淘汰策略来管理内存。
- 网络带宽：服务器为了更高效地处理来自客户端的请求，在 Redis 6.0 版本将网络 IO 模块改变成多线程处理。

### 外部因素

Redis 运行的外部环境，也就是操作系统和硬件显然也会影响 Redis 的性能。

- CPU：CPU 的好坏很直接地影响到程序的性能。
- 虚拟化：在虚拟机中运行 Redis 服务器和物理机共享一个物理网口，并且一台物理机可能有多个虚拟机在运行，因此在内存占用上和网络延迟方面都会有很糟糕的表现。
- 内存管理：物理内存不足时，使用 swap 空间既交换空间，而当操心系统将 Redis 所用的内存分页移至 swap 空间时，将会阻塞 Redis 进程，导致 Redis 出现延迟，从而影响 Redis 的整体性能。
- THP 特性：Linux kernel 在 2.6.38 内核增加了 Transparent Huge Pages (THP) 特性 ，支持大内存页 2MB 分配，默认开启。当开启了 THP 时，fork 的速度会变慢，fork 之后每个内存页从原来 4KB 变为 2MB，会大幅增加重写期间父进程内存消耗。