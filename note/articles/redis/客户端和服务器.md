# 客户端和服务器

Redis 是典型的一对多的服务器程序：一个服务器可以和多个客户端建立连接。通过使用 I/O 多路复用实现的文件事件处理器，Redis 服务器使用单进程单线程的方式处理命令，并与多个客户端进行网络通信。

### 通信协议

RESP 是 Redis 序列化协议（Redis Serialization Protocol）的简写，它是文本协议，优势在于实现过程异常简单、解析性能好、有可读性。

RESP 将传输的结构分为 5 种最小单元，单元结束的时候统一加上回车换行符号\r\n。
- 单行字符串以 `+` 符号开头。
- 多行字符串以 `$` 符号开头，后跟字符串长度。 
- 整数值以 `:` 符号开头，后跟整数的字符串形式。
- 错误消息以 `-` 符号开头。
- 数组以 `*` 号开头，后跟数组的长度。

单行字符串 hello world

```C
+hello world\r\n
```

多行字符串 hello world

```C
$11\r\nhello world\r\n
```

整数 1024

```C
:1024\r\n
```

错误 参数类型错误

```C
-WRONGTYPE Operation against a key holding the wrong kind of value
```

数组 [1,2,3]

```C
*3\r\n:1\r\n:2\r\n:3\r\n
```

NULL 用多行字符串表示，不过长度要写成-1。

```C
$-1\r\n
```

空串 用多行字符串表示，长度填 0，两个\r\n 之间,隔的是空串。

```C
$0\r\n\r\n
```

### 命令请求的执行过程

一个命令请求从发送到获得回复的过程中， 客户端和服务器需要完成一系列操作。
- 发生命令请求
- 读取命令请求
- 查找命令实现
- 执行预备操作
- 调用命令实现函数
- 执行后续工作
- 将命令回复发送给客户端
- 客户端接收并打印命令回复

### serverCron


### 初始化服务器