# 表

本章将描述 InnoDB 存储引擎中数据在表中是如何组织和存放的，这是关系型数据库模型的核心。

### 索引组织表

前面提到，InnoDB 存储引擎都是根据主键组成的，即使没有显式地创建主键，InnoDB也会选择或者创建主键，这种存储方式称为索引组织表。

当创建表没有显示定义主键，InnoDB 存储引擎主键确定方式：
- 首先贩判断表中是否有非空的唯一索引，如果有或有多个，选择第一个定义的唯一索引为主键。
- 如果不符合上面条件，InnoDB 存储引擎主动创建一个 6 字节大小的 _rowid 作为主键。

### InnoDB 逻辑存储结构
InnoDB 存储引擎中，所有的数据都被逻辑的存放到一个空间，被称为表空间（tablespace）。表空间又由段（segment）、区（extent）、页（page）组成，InnoDB 存储引擎的逻辑存储结构如下图所示：

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/mysql/InnoDB逻辑存储结构.png" width="600px">
</div>

表空间是 InnoDB 存储引擎逻辑结构的最高处，所有数据都存放在表空间中。默认情况下InnoDB只有一个共享表空间 ibdata1，即所有的数据都存放在这个表空间中。如果用户启用了`innodb_file_per_table`，则每张表内的数据可以单独放到一个表空间内。
需要注意的是，如果启用了innodb_file_per_table 参数，每张表的表空间内存放的只是数据、索引和插入缓冲 Bitmap 页，其他类的数据，如回滚信息，插入缓冲索引页、系统事务信息，二次写缓冲等还是存放在原来的共享表空间内。所以即便开启了 innodb_file_per_table 之后，共享表空间还是会不断增大的。

表空间由各个段组成，如数据段、索引段、回滚段等。InnoDB 存储引擎是索引组织表，数据即索引，故数据段即为 B+ 树叶子节点，索引段即为 B+ 树非叶子节点。InnoDB 存储存储引擎中段的管理是存储引擎自身完成的，无需人工管理。

区是连续页组成的空间，一个区的大小为 1MB,默认情况 InnoDB 存储引擎页的大小为16KB，即一个区一共有 64 个连续的页。为了保证区的连续性，InnoDB 存储引擎每次从磁盘申请 4~5 个区。

InnoDB 存储引擎中页是磁盘管理的最小单位，页大小一经设置不可以对其再次修改，常见的页类型有：
- 数据页（B-tree Node）
- undo页(undo Log Page)
- 系统页(System Page)
- 事务数据页(Transaction Page)
- 插入缓冲位图页(Insert Buffer Page)
- 插入缓冲空闲列表页(Insert Buffer Free List)
- 未压缩的二进制大对象页(Uncompressed BLOB Page)
- 压缩的二进制大对象页(compressed BLOB Page)

InnoDB 存储引擎是面向列的（row-oriented），即数据按行存放，每页存放的行记录页是有硬性定义的。最多允许存放 16K/2-200 行的记录，即 7992 行记录。

### 行记录格式

### InnoDB 数据页结构

### 约束


### 视图


### 分区表