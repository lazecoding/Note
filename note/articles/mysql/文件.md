# 文件

MySQL 数据库正常运行依赖与各种文件，分为 MySQL 数据库文件和存储引擎文件,具体有以下几类：
- 参数文件
- pid 文件
- 日志文件
- 表结构定义文件
- 存储引擎文件

### 参数文件

MySQL 实例启动首先会去读取一个参数配置文件，用来初始化数据库参数和环境，通过命令 mysql--help | grep my.cnf 寻找即可。参数文件参数配置是以键值对的方式存储的吗，可以通过 `SHOW VARIABLES` 查看数据库中所有参数。

MySQL 参数可以分为两类：动态参数和静态参数。动态参数意味着可以在 MySQL 实例运行期间更改生效，静态参数意味着更改这些参数在整个实例周期都不会生效。

### pid 文件

MySQL 实例启动时会将自己的进程 ID 写入到 pid 文件中，

### 日志文件

MySQL 数据库最常见的日志有以下几种：
- 错误日志文件（error log）
- 慢查询日志（slow query log）
- 查询日志（log）
- 二进制日志（bin log）

#### 错误日志

错误日志记录了 MySQL 实例从启动、运行到关闭整个生命周期信息，该日志除了错误日志还记录了一些警告或正确的信息，可以通过命令 `SHOW VARIABLES LIKE 'log_error'` 定位文件。

```sql
mysql> SHOW VARIABLES LIKE 'log_error';

Variable_name: log_error
        Value: /var/log/mysqld.log
```

#### 慢查询日志

慢查询日志可以定位可能存在问题的 SQL 语句，从而进行 SQL 层面优化。通过 `long_query_time` 参数可以配置慢查询阈值，默认值是 10，单位秒。

默认情况 MySQL 是不会开启慢查询日志的，可以通过下面命令查询慢查询日志是否启用、慢查询日志路径和开启慢查询日志。

```sql
SHOW VARIABLES LIKE like 'slow_query_log%';

set global slow_query_log=ON;
```

还有一个与之相关的参数——`log_queries_not_using_indexes``，用于记录未使用所有的 SQL 语句。

```sql
SHOW VARIABLES LIKE 'log_queries_not_using_indexes';
```

用户可以通过 `mysqldumpslow` 命令分析慢查询日志,帮助信息如下：

```sql
-s, 是表示按照何种方式排序
    c: 访问计数
    l: 锁定时间
    r: 返回记录
    t: 查询时间
    al:平均锁定时间
    ar:平均返回记录数
    at:平均查询时间

-t, 是top n的意思,即为返回前面多少条的数据;

-g, 后边可以写一个正则匹配模式,大小写不敏感的;
```

MySQL 5.1 版本支持 Table 类型慢查询日志，表为 mysql.slow_log，参数 log_output 指定慢查询输出的格式，默认为 FILE，修改为 TABLE 则变更为 TABLE 类型慢查询日志。

```sql
SHOW CREATE TABLE mysql.slow_log;

-- slow_log 建表语句
CREATE TABLE `slow_log` (
    `start_time` timestamp(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),
    `user_host` mediumtext NOT NULL,
    `query_time` time(6) NOT NULL,
    `lock_time` time(6) NOT NULL,
    `rows_sent` int(11) NOT NULL,
    `rows_examined` int(11) NOT NULL,
    `db` varchar(512) NOT NULL,
    `last_insert_id` int(11) NOT NULL,
    `insert_id` int(11) NOT NULL,
    `server_id` int(10) unsigned NOT NULL,
    `sql_text` mediumblob NOT NULL,
    `thread_id` bigint(21) unsigned NOT NULL
) ENGINE=CSV DEFAULT CHARSET=utf8 COMMENT='Slow log'

-- 设置慢查询日志类型为 TABLE
SET GLOBAL log_output='TABLE';
```

#### 二进制日志

二进制日志（bin log）记录了对 MySQL 数据库执行的（可能产生）更改操作，二进制日志还包括了执行数据库更改操作的时间等其他额外信息，二进制日志主要包含以下几种作用：
- `恢复（recovery）`：某些数据的恢复需要二进制日志，例如，在一个数据库全备份文件恢复后，用户可以通过二进制日志进行 point-in-time 恢复。
- `复制（replication）`：其原理与恢复类似，通过复制和执行二进制日志使一台远程的 MySQL 数据库（Slave）与一台 MySQL 数据库（master）进行实时同步。
- `审计（audit）`：用户可以通过二进制日志中的信息来进行审计，判断是否有对数据库进行注入的攻击。

默认情况下二进制日志不会开启，可以通过配置参数 log-bin [=name] 可以启动二进制日志。如果不指定 name，则默认二进制日志文件名为主机名，后缀名为二进制日志的序列号，路径为数据库所在目录（datadir）。 




#### 查询日志

查询日志记录了所有对 MySQL 数据库请求信息，无论正确与否。

### 表结构定义文件

<!-- frm -->


### 存储引擎文件

InnoDB 为例：

表空间文件 ： 
重做日志文件
