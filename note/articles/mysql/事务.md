# 事务

事务（Transaction）是指数据库从一种状态转换为另一种一致状态，即操作提交，要么确保所有操作都保存，要不所有操作都不保存。

### 认识事务

事务可由一条或一组 SQL 语句组成，事务是访问并更新数据库中各种数据项的一个程序单元。在事务中的一组操作，要么都执行，要么都不执行。事务必须满足四个特性，简称 ACID。

InnoDB 存储引擎是 MySQL 数据库第一个严格满足事务的存储引擎，完全符合 ACID 特性：
- `原子性（Atomicity）`： 一个事务内的所有操作要么全部成功，要么全部失败。
- `一致性（Consistent）`：保证磁盘和缓存的数据一致，bin log 数据和主库中的数据一致。
- `隔离性（Isalotion）`：每个读写事务的对象对于其他事务相互分离，即该事务提交前其他事务不可见。
- `持久性（Durable）`： 事务一旦提交，其结果就是永久的。

### 事务分类

从事务理论角度，事务分为以下几类：
- 扁平事务（Flat Transactions）
- 带有保存点的扁平事务（Flat Transactions with SavePoints）
- 链事务（Chained Transactions）
- 嵌套事务（Nested Transactions）
- 分布式事务（Disriebuted Transactions）

扁平事务是最简单是事务，也是实际环境最为频繁使用的事务类型。扁平事务中，所有操作都处于同一层次，其由 BEGIN WORK 开始，由 COMMIT WORK 或 ROLLBACK WORK 结束，扁平事务是应用程序成为原子操作的基本组成模块。

扁平事务的缺点在于不能更细粒度的控制事务，并不是所有情况都需要事务全部回滚，而且整个事务的回滚也意味着更大的开销，因此产生了带有保存点的扁平事务。带有保存点的扁平事务除了支持扁平事务支持的操作外，允许在事务执行过程中回滚到同一事务中较早的一个状态。

当发生系统崩溃时，带有保存点的扁平事务所有的保存点都将消失，这意味着当进行恢复时，事务需要从开始处重新执行。链事务是带有保存点的扁平事务的改进，链事务的思想是：在提交一个事务时，释放不需要的数据对象，将必要的处理上下文隐式地传给下一个要开始的事务。注意，提交事务操作和开始下一个事务操作将合并为一个原子操作。这意味着下一个事务看到上一个事务的结果，就好像在一个事务中进行的一样。

嵌套事务是一个层次结构框架。由一个顶层事务控制着各个层次的事务，顶层事务之下嵌套的事务被称为子事务（subtransaction），其控制每一个局部的变换。（InnoDB 存储引擎不支持嵌套事务）

分布式事务是在分布式环境下运行的扁平事务，需要根据数据所在位置访问网站中的不同节点。

### 事务实现


### 事务控制


### TPS


### 隔离级别


### 分布式事务


### 长事务