# OSS

- 目录
    - [基本概念](#基本概念)
    - [存储类型](#存储类型)
    - [特性](#特性)
        - [强一致性](#强一致性)
        - [数据冗余](#数据冗余)
    - [OSS与文件系统的对比](#OSS与文件系统的对比)

对象存储服务（Object Storage Service，OSS）是一种海量、安全、低成本、高可靠的云存储服务，适合存放任意类型的文件。容量和处理能力弹性扩展，多种存储类型供选择，全面优化存储成本。

其数据设计持久性不低于 99.9999999999%（12个9），服务可用性（或业务连续性）不低于 99.995%。

OSS 具有丰富的安全防护能力，支持服务器端加密、客户端加密、防盗链白名单、细粒度权限管控、日志审计、合规保留策略（WORM）等特性。

OSS 具有与平台无关的 RESTful API 接口，并提供的 API、SDK、OSS 迁移工具将海量数据移入或移出 OSS。

### 基本概念

OSS 中涉及的几个基本概念：

- 存储空间（Bucket）

存储空间是用户用于存储对象（Object）的容器，所有的对象都必须隶属于某个存储空间。同一个存储空间的内部是扁平的，没有文件系统的目录等概念，所有的对象都直接隶属于其对应的存储空间。
存储空间的名称在 OSS 范围内必须是全局唯一的，一旦创建之后无法修改名称。

每个用户可以拥有多个存储空间,用户可以根据实际需求，创建不同类型的存储空间来存储不同的数据。

- 对象（Object）

对象是 OSS 存储数据的基本单元，和传统的文件系统不同，对象没有文件目录层级结构的关系。对象由元信息（Object Meta），用户数据（Data）和文件名（Key）组成，并且由存储空间内部唯一的Key来标识。对象元信息是一组键值对，表示了对象的一些属性，比如最后修改时间、大小等信息，同时用户也可以在元信息中存储一些自定义的信息。

在整个 OSS 对象生命周期内，除通过追加方式上传的 Object 可以通过继续追加上传写入数据外，其他方式上传的 Object 内容无法编辑，只能通过重复上传同名的对象来覆盖之前的对象。

- ObjectKey

ObjectKey 表示上传的 Object 所在存储空间的完整名称，即包含文件后缀在内的完整路径，如填写为 `oss/attach/a.jpg`。

- Region（地域）

Region 表示 OSS 的数据中心所在物理位置,用户可以根据费用、请求来源等选择合适的地域创建 Bucket。

Region 是在创建 Bucket 的时候指定的，该 Bucket 下所有的 Object 都存储在对应的数据中心，一旦指定之后就不允许更改。

- Endpoint（访问域名）

Endpoint 表示 OSS 对外服务的访问域名。OSS 以 HTTP RESTful API 的形式对外提供服务，当访问不同的 Region 的时候，需要不同的域名。通过内网和外网访问同一个 Region 所需要的 Endpoint 也是不同的。
例如杭州 Region 的外网 Endpoint 是 oss-cn-hangzhou.aliyuncs.com，内网 Endpoint 是 oss-cn-hangzhou-internal.aliyuncs.com。

- AccessKey（访问密钥）

AccessKey 指的是访问身份验证中用到的 AccessKeyId 和 AccessKeySecret。OSS 通过使用 AccessKeyId 和 AccessKeySecret 对称加密的方法来验证某个请求的发送者身份。

### 存储类型

OSS 提供标准、低频访问、归档、冷归档 4 种存储类型，全面覆盖从热到冷的各种数据存储场景。

- 标准存储（Standard）

提供高可靠、高可用、高性能的对象存储服务，能够支持频繁的数据访问。

适用于各种社交、分享类的图片、音视频应用、大型网站、大数据分析等业务场景。

提供标准存储-本地冗余（LRS）和标准存储-同城冗余（ZRS）两种数据冗余存储方式。

`标准存储-本地冗余（LRS）`：采用数据冗余存储机制，将每个对象的不同冗余存储在同一个可用区内多个设施的多个设备上，确保硬件失效时的数据持久性和可用性。

`标准存储-同城冗余（ZRS）`：采用多可用区（AZ）机制，将用户的数据分散存放在同一地域（Region）的 3 个可用区。当某个可用区不可用时，仍然能够保障数据的正常访问。

- 低频访问（Infrequent Access）

提供高持久性、较低存储成本的对象存储服务。有最低存储时间（30 天）和最小计量单位（64 KB）要求。支持数据实时访问，访问数据时会产生数据取回费用。

适用于较低访问频率（平均每月访问频率 1-2 次）的业务场景。

提供低频访问-本地冗余（LRS）和低频访问-同城冗余（ZRS）两种数据冗余存储方式。

`低频访问-本地冗余（LRS）`：采用数据冗余存储机制，将每个对象的不同冗余存储在同一个可用区内多个设施的多个设备上，确保硬件失效时的数据持久性和可用性。
`低频访问-同城冗余（ZRS）`：采用多可用区（AZ）机制，将用户的数据分散存放在同一地域（Region）的3个可用区。当某个可用区不可用时，仍然能够保障数据的正常访问。

- 归档存储（Archive）

提供了高持久性、极低存储成本的对象存储服务。有最低存储时间（60 天）和最小计量单位（64 KB）要求。数据需解冻（约 1 分钟）后访问，解冻会产生数据取回费用。

适用于数据长期保存的业务场景。

- 冷归档存储（Cold Archive）

提供了高持久性的对象存储服务，存储费用在四种存储类型中最低。有最低存储时间（180 天）和最小计量单位（64 KB）要求。数据需解冻后访问，解冻时间根据数据大小和选择的解冻模式决定，解冻会产生数据取回费用。

适用于需要超长时间存放的极冷数据。

### 特性

#### 强一致性

Object 操作在 OSS 上具有原子性，操作要么成功要么失败，不会存在有中间状态的 Object。OSS 保证用户一旦上传完成之后读到的 Object 是完整的，OSS 不会返回给用户一个部分上传成功的 Object。

Object 操作在 OSS 同样具有强一致性，用户一旦收到了一个上传（PUT）成功的响应，该上传的 Object 就已经立即可读，并且 Object 的冗余数据已经写成功。不存在一种上传的中间状态，即 read-after-write 却无法读取到数据。对于删除操作也是一样的，用户删除指定的 Object 成功之后，该 Object 立即变为不存在。

#### 数据冗余

OSS 使用基于纠删码、多副本的数据冗余存储机制，将每个对象的不同冗余存储在同一个区域内多个设施的多个设备上，确保硬件失效时的数据持久性和可用性。

- OSS 会通过计算网络流量包的校验和，验证数据包在客户端和服务端之间传输中是否出错，保证数据完整传输。

- OSS的冗余存储机制，可支持两个存储设施并发损坏时，仍维持数据不丢失。

### OSS与文件系统的对比

对比项     | OSS                                                                             | 文件系统
 --------- | --------------------------------------------------------------------------------| ----------------------------------------------------------------------
数据模型    | Key-Value 形式的分布式对象存储服务。                                                 | 文件系统是一种典型的树状索引结构。
数据获取    | 根据 Object 的名称（Key）唯一的获取该 Object。                                        | 根据文件全路径访问文件目录下文件
优势       | 支持海量的用户并发访问。                                                             | 支持文件修改、目录转移等操作
劣势	   | OSS保存的Object不支持修改，而且 OSS 模拟文件夹操作<br>十分耗费性能，需要处理所有 XXX 开头的 Key。 | 受限于单个设备的性能。访问越深的目录<br>消耗的资源也越大，操作拥有很多文件的目录也会非常慢。