# 基础架构

- 目录
    - [模块化](#模块化)

Nginx 是高度模块化的设计，除了少量的核心代码，其它一切皆模块。

### 模块化

Nginx 的模块化设计要求所有模块的遵循 ngx_module_t 接口设计规范，保持设计的简单些和扩展性。
基本接口 ngx_module_t 十分简单，只涉及模块的初始化、退出以及对配置项的处理，这还带来了足够的灵活性，使得 Nginx 比较简单地实现了动态可修改性，也就是保持服务正常运行下使系统功能发生改变。

所有的模块间是分层次、分类别的，Nginx 共有五大类型的模块：核心模块、配置模块、事件模块、HTTP 模块、mail 模块。它们都具备相同的 ngx_module_t 接口，但在请求处理流程中的层次并不相同。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/nginx/模块化设计.png" width="600px">
</div>

在这五种模块中，配置模块和核心模块是其他模块的基础。而事件模块则是 HTTP 模块和 mail 模块的基础，HTTP 模块和 mail 模块更关注应用层面。
在事件模块中，ngx_event_core_module 事件模块是其他所有事件模块的基础；在 HTTP 模块中，ngx_http_core_module 模块是其他 HTTP 模块的基础；在 mail 模块中，ngx_mail_core_module 模块是其他所有 mail 模块的基础。

### 事件驱动架构

事件驱动架构是一种用于设计应用的软件架构和模型。对于事件驱动系统而言，事件的捕获、通信、处理和持久保留是解决方案的核心结构。这和传统的请求驱动模型有很大不同。

对于 Nginx 而言，一般会由网卡、磁盘产生事件，由事件模块将负责事件的收集和分发，而所有的模块都可能是事件消费者，它们首先需要向事件模块注册感兴趣的事件类型，当有事件产生时，事件模块会把事件分发到相应的模块中进行处理。

Nginx 采用的事件驱动架构，由事件收集、分发者管理进程资源，它们会在分发某个事件时调用事件消费模块使用当前占用的进程资源。
处理请求事件时，Nginx 的事件消费者只是被事件分发者进程短期调用而已，这种设计使得网络性能、用户感知的请求时延都得到了提升，每个用户的请求所产生的事件会及时响应，整个服务器的网络吞吐量都会由于事件的及时响应而增大。
当然，这也带来一定的要求，即每个事件消费者都不能有阻塞行为，否则将会由于长时间占用事件分发者进程而导致其他事件得不到及时响应，Nginx 的非阻塞特性就是由于它的模块都是满足这个要求的。

<div align="left">
    <img src="https://github.com/lazecoding/Note/blob/main/images/nginx/Nginx事件模型.png" width="600px">
</div>

### HTTP 模块

### mail 模块